CREATE VIEW `v_itv_agent_channels_detail` AS (select `agents`.`id` AS `agent_id`,`itv`.`id` AS `itv_id`,`agents`.`fname` AS `fname`,`agents`.`lname` AS `lname`,`users`.`mac` AS `mac`,`itv`.`name` AS `name` from (((((`users` join `tariff_plan` on((`tariff_plan`.`id` = `users`.`tariff_plan_id`))) join `package_in_plan` on(((`tariff_plan`.`id` = `package_in_plan`.`plan_id`) and (`package_in_plan`.`optional` = 0)))) join `service_in_package` on((`service_in_package`.`package_id` = `package_in_plan`.`package_id`))) join `itv` on((`service_in_package`.`service_id` = `itv`.`id`))) join `agents` on((`users`.`agent` = `agents`.`id`))) where ((`users`.`status` = 0) and (`users`.`mem_expire` > (now() - interval 1 month)))) union (select `agents`.`id` AS `agent_id`,`itv`.`id` AS `itv_id`,`agents`.`fname` AS `fname`,`agents`.`lname` AS `lname`,`users`.`mac` AS `mac`,`itv`.`name` AS `name` from ((((`users` join `user_package_subscription` on((`users`.`id` = `user_package_subscription`.`user_id`))) join `service_in_package` on(((`service_in_package`.`package_id` = `user_package_subscription`.`package_id`) and (`service_in_package`.`type` = 'tv')))) join `itv` on((`service_in_package`.`service_id` = `itv`.`id`))) join `agents` on((`users`.`agent` = `agents`.`id`))) where ((`users`.`status` = 0) and (`users`.`mem_expire` > (now() - interval 1 month))));
CREATE VIEW `v_itv_agent_channels_summary` AS select concat(`t_count`.`fname`,' ',`t_count`.`lname`) AS `agent`,`t_count`.`name` AS `channel_name`,count(distinct `t_count`.`mac`) AS `subscribers` from `v_rodeo_agent_channels_detail` `t_count` group by `t_count`.`agent_id`,`t_count`.`itv_id`;
